/*! ez3 30-07-2015 */
var EZ3={VERSION:"1.0.0"};EZ3.Engine=function(a,b){this.canvas=a||document.createElement("canvas"),this.canvas.width=a.width||800,this.canvas.height=a.height||600;try{this.gl=a.getContext("webgl",b)||a.getContext("experimental-webgl",b)}catch(c){throw new Error("WebGl not supported")}this.setViewport(0,0,this.canvas.width,this.canvas.height)},EZ3.Engine.prototype.setViewport=function(a,b,c,d){this.gl.viewport(a,b,c,d)},EZ3.Keyboard=function(a){this._domElement=a,this._keys=[],this.enabled=!1,this.callbacks={},this.callbacks.context=this,this.callbacks.onKeyPress=null,this.callbacks.onKeyDown=null,this.callbacks.onKeyRelease=null},EZ3.Keyboard.prototype._processKeyDown=function(a){this._keys[a.keyCode]||(this._keys[a.keyCode]=new EZ3.Key(a.keyCode)),this._keys[a.keyCode].processDown(this.callbacks.context,this.callbacks.onKeyPress,this.callbacks.onKeyDown)},EZ3.Keyboard.prototype._processKeyUp=function(a){this._keys[a.keyCode].processUp(this.callbacks.context,this.callbacks.onKeyRelease)},EZ3.Keyboard.prototype.enable=function(){var a=this;this.enabled=!0,this._onKeyDown=function(b){a._processKeyDown(b)},this._onKeyUp=function(b){a._processKeyUp(b)},this._domElement.addEventListener("keydown",this._onKeyDown,!1),this._domElement.addEventListener("keyup",this._onKeyUp,!1)},EZ3.Keyboard.prototype.disable=function(){this.enabled=!1,this._domElement.removeEventListener("keydown",this._onKeyDown),this._domElement.removeEventListener("keyup",this._onKeyUp)},EZ3.Keyboard.prototype.getKey=function(a){return this._keys[a]||(this._keys[a]=new EZ3.Key(a)),this._keys[a]},EZ3.Keyboard.A="A".charCodeAt(0),EZ3.Keyboard.B="B".charCodeAt(0),EZ3.Keyboard.C="C".charCodeAt(0),EZ3.Keyboard.D="D".charCodeAt(0),EZ3.Keyboard.E="E".charCodeAt(0),EZ3.Keyboard.F="F".charCodeAt(0),EZ3.Keyboard.G="G".charCodeAt(0),EZ3.Keyboard.H="H".charCodeAt(0),EZ3.Keyboard.I="I".charCodeAt(0),EZ3.Keyboard.J="J".charCodeAt(0),EZ3.Keyboard.K="K".charCodeAt(0),EZ3.Keyboard.L="L".charCodeAt(0),EZ3.Keyboard.M="M".charCodeAt(0),EZ3.Keyboard.N="N".charCodeAt(0),EZ3.Keyboard.O="O".charCodeAt(0),EZ3.Keyboard.P="P".charCodeAt(0),EZ3.Keyboard.Q="Q".charCodeAt(0),EZ3.Keyboard.R="R".charCodeAt(0),EZ3.Keyboard.S="S".charCodeAt(0),EZ3.Keyboard.T="T".charCodeAt(0),EZ3.Keyboard.U="U".charCodeAt(0),EZ3.Keyboard.V="V".charCodeAt(0),EZ3.Keyboard.W="W".charCodeAt(0),EZ3.Keyboard.X="X".charCodeAt(0),EZ3.Keyboard.Y="Y".charCodeAt(0),EZ3.Keyboard.Z="Z".charCodeAt(0),EZ3.Keyboard.ZERO="0".charCodeAt(0),EZ3.Keyboard.ONE="1".charCodeAt(0),EZ3.Keyboard.TWO="2".charCodeAt(0),EZ3.Keyboard.THREE="3".charCodeAt(0),EZ3.Keyboard.FOUR="4".charCodeAt(0),EZ3.Keyboard.FIVE="5".charCodeAt(0),EZ3.Keyboard.SIX="6".charCodeAt(0),EZ3.Keyboard.SEVEN="7".charCodeAt(0),EZ3.Keyboard.EIGHT="8".charCodeAt(0),EZ3.Keyboard.NINE="9".charCodeAt(0),EZ3.Keyboard.NUMPAD_0=96,EZ3.Keyboard.NUMPAD_1=97,EZ3.Keyboard.NUMPAD_2=98,EZ3.Keyboard.NUMPAD_3=99,EZ3.Keyboard.NUMPAD_4=100,EZ3.Keyboard.NUMPAD_5=101,EZ3.Keyboard.NUMPAD_6=102,EZ3.Keyboard.NUMPAD_7=103,EZ3.Keyboard.NUMPAD_8=104,EZ3.Keyboard.NUMPAD_9=105,EZ3.Keyboard.NUMPAD_MULTIPLY=106,EZ3.Keyboard.NUMPAD_ADD=107,EZ3.Keyboard.NUMPAD_ENTER=108,EZ3.Keyboard.NUMPAD_SUBTRACT=109,EZ3.Keyboard.NUMPAD_DECIMAL=110,EZ3.Keyboard.NUMPAD_DIVIDE=111,EZ3.Keyboard.F1=112,EZ3.Keyboard.F2=113,EZ3.Keyboard.F3=114,EZ3.Keyboard.F4=115,EZ3.Keyboard.F5=116,EZ3.Keyboard.F6=117,EZ3.Keyboard.F7=118,EZ3.Keyboard.F8=119,EZ3.Keyboard.F9=120,EZ3.Keyboard.F10=121,EZ3.Keyboard.F11=122,EZ3.Keyboard.F12=123,EZ3.Keyboard.F13=124,EZ3.Keyboard.F14=125,EZ3.Keyboard.F15=126,EZ3.Keyboard.COLON=186,EZ3.Keyboard.EQUALS=187,EZ3.Keyboard.COMMA=188,EZ3.Keyboard.UNDERSCORE=189,EZ3.Keyboard.PERIOD=190,EZ3.Keyboard.QUESTION_MARK=191,EZ3.Keyboard.TILDE=192,EZ3.Keyboard.OPEN_BRACKET=219,EZ3.Keyboard.BACKWARD_SLASH=220,EZ3.Keyboard.CLOSED_BRACKET=221,EZ3.Keyboard.QUOTES=222,EZ3.Keyboard.BACKSPACE=8,EZ3.Keyboard.TAB=9,EZ3.Keyboard.CLEAR=12,EZ3.Keyboard.ENTER=13,EZ3.Keyboard.SHIFT=16,EZ3.Keyboard.CONTROL=17,EZ3.Keyboard.ALT=18,EZ3.Keyboard.CAPS_LOCK=20,EZ3.Keyboard.ESC=27,EZ3.Keyboard.SPACEBAR=32,EZ3.Keyboard.PAGE_UP=33,EZ3.Keyboard.PAGE_DOWN=34,EZ3.Keyboard.END=35,EZ3.Keyboard.HOME=36,EZ3.Keyboard.LEFT=37,EZ3.Keyboard.UP=38,EZ3.Keyboard.RIGHT=39,EZ3.Keyboard.DOWN=40,EZ3.Keyboard.PLUS=43,EZ3.Keyboard.MINUS=44,EZ3.Keyboard.INSERT=45,EZ3.Keyboard.DELETE=46,EZ3.Keyboard.HELP=47,EZ3.Keyboard.NUM_LOCK=144,EZ3.Mouse=function(a){this._domElement=a,this.pointer=new EZ3.MousePointer,this.enabled=!1},EZ3.Mouse.prototype._processDown=function(a){this.pointer.processDown(a)},EZ3.Mouse.prototype._processMove=function(a){this.pointer.processMove(a)},EZ3.Mouse.prototype._processUp=function(a){this.pointer.processUp(a)},EZ3.Mouse.prototype._processWheel=function(a){this.pointer.processWheel(a)},EZ3.Mouse.prototype.enable=function(){var a=this;this.enabled=!0,this._onDown=function(b){a._processDown(b)},this._onMove=function(b){a._processMove(b)},this._onUp=function(b){a._processUp(b)},this._onWheel=function(b){a._processWheel(b)},this._domElement.addEventListener("mousedown",this._onDown,!0),this._domElement.addEventListener("mousemove",this._onMove,!0),this._domElement.addEventListener("mouseup",this._onUp,!0),this._domElement.addEventListener("mousewheel",this._onWheel,!0),this._domElement.addEventListener("DOMMouseScroll",this._onWheel,!0)},EZ3.Mouse.prototype.disable=function(){this.enabled=!1,this._domElement.removeEventListener("mousedown",this._onDown,!0),this._domElement.removeEventListener("mousemove",this._onMove,!0),this._domElement.removeEventListener("mouseup",this._onUp,!0),this._domElement.removeEventListener("mousewheel",this._onWheel,!0),this._domElement.removeEventListener("DOMMouseScroll",this._onWheel,!0)},EZ3.Mouse.prototype.constructor=EZ3.Mouse,EZ3.Mouse.LEFT_BUTTON=0,EZ3.Mouse.RIGHT_BUTTON=1,EZ3.Mouse.MIDDLE_BUTTON=2,EZ3.Mouse.BACK_BUTTON=3,EZ3.Mouse.FORWARD_BUTTON=4,EZ3.MousePointer=function(){EZ3.Pointer.call(this,1),this._buttons=[],this.wheel=EZ3.Vector2.create()},EZ3.MousePointer.prototype.processDown=function(a){this._states[a.button]=!0,EZ3.Pointer.prototype.processDown.call(this,a)},EZ3.MousePointer.prototype.processMove=function(a){EZ3.Pointer.prototype.processMove.call(this,a)},EZ3.MousePointer.prototype.processUp=function(a){this._states[a.button]=!1},EZ3.MousePointer.prototype.processWheel=function(a){a.wheelDeltaX?this.wheel[0]=a.wheelDeltaX:this.wheel[1]=a.deltaX,a.wheelDeltaY?this.wheel[0]=a.wheelDeltaY:this.wheel[1]=a.deltaY},EZ3.MousePointer.prototype.getButton=function(a){this._buttons[a]||(this._buttons[a]=new EZ3.Button(a))},EZ3.MousePointer.prototype.constructor=EZ3.MousePointer,EZ3.Pointer=function(a){this.id=a,this.client=EZ3.Vector2.create(),this.page=EZ3.Vector2.create(),this.screen=EZ3.Vector2.create()},EZ3.Pointer.prototype.processDown=function(a){this.processMove(a)},EZ3.Pointer.prototype.processMove=function(a){this.client[0]=a.clientX,this.client[1]=a.clientY,this.page[0]=a.pageX,this.page[1]=a.pageY,this.screen[0]=a.screenX,this.screen[0]=a.screenY},EZ3.Pointer.prototype.constructor=EZ3.Pointer,EZ3.Switch=function(a){this._state=!1,this.code=a},EZ3.Switch.prototype.processDown=function(a,b,c){var d=this.isUp();this._state=!0,d&&b&&b.call(a,this),c&&c.call(a,this)},EZ3.Switch.prototype.processUp=function(a,b){this._state=!1,b&&b.call(a,this)},EZ3.Switch.prototype.isDown=function(){return this._state},EZ3.Switch.prototype.isUp=function(){return!this._state},EZ3.Switch.prototype.constructor=EZ3.Switch,EZ3.Key=EZ3.Switch,EZ3.Button=EZ3.Switch,EZ3.Geometry=function(){this._uv=[],this._indices=[],this._normals=[],this._vertices=[],this._tangents=[],this._binormals=[],this._maxPoint=vec3.create(),this._minPoint=vec3.create(),this._midPoint=vec3.create()},EZ3.Geometry.PI=Math.PI,EZ3.Geometry.HALF_PI=.5*Math.PI,EZ3.Geometry.DOUBLE_PI=2*Math.PI,EZ3.Geometry.prototype.initArray=function(a,b){return Array.apply(null,new Array(a)).map(function(){return b})},EZ3.Geometry.prototype.calculateNormals=function(){var a,b,c,d,e,f,g,h,i,j,k=this.initArray(this.vertices.length,0),l=this.initArray(this.vertices.length/3,0);for(d=0;d<this._indices.length;d+=3)a=3*this._indices[d+0],b=3*this._indices[d+1],c=3*this._indices[d+2],f=vec3.create(this.vertices[a+0],this.vertices[a+1],this.vertices[a+2]),g=vec3.create(this.vertices[b+0],this.vertices[b+1],this.vertices[b+2]),h=vec3.create(this.vertices[c+0],this.vertices[c+1],this.vertices[c+2]),vec3.subtract(i,g,f),vec3.subtract(j,h,f),vec3.cross(e,i,j),(0!==e.x||0!==e.y||0!==e.z)&&vec3.normalize(e,e),k[a+0]+=e[0],k[a+1]+=e[1],k[a+2]+=e[2],k[b+0]+=e[0],k[b+1]+=e[1],k[b+2]+=e[2],k[c+0]+=e[0],k[c+1]+=e[1],k[c+2]+=e[2],++l[a/3],++l[b/3],++l[c/3];for(d=0;d<this._vertices.length/3;++d)a=3*d+0,b=3*d+1,c=3*d+2,this._normals.push(k[a]/l[d]),this._normals.push(k[b]/l[d]),this._normals.push(k[c]/l[d]);k.splice(0,k.length),l.splice(0,l.length)},EZ3.Geometry.prototype.updateMaxPoint=function(a,b,c){this._maxPoint[0]=Math.max(this._maxPoint[0],a),this._maxPoint[1]=Math.max(this._maxPoint[1],b),this._maxPoint[2]=Math.max(this._maxPoint[2],c)},EZ3.Geometry.prototype.updateMinPoint=function(a,b,c){this._minPoint[0]=Math.min(this._minPoint[0],a),this._minPoint[1]=Math.min(this._minPoint[1],b),this._minPoint[2]=Math.min(this._minPoint[2],c)},EZ3.Geometry.prototype.calculateMidPoint=function(){this._midPoint[0]=.5*(this._maxPoint[0]+this._minPoint[0]),this._midPoint[0]=.5*(this._maxPoint[1]+this._minPoint[1]),this._midPoint[0]=.5*(this._maxPoint[2]+this._minPoint[2])},EZ3.Geometry.prototype.calculateTangents=function(){},EZ3.Geometry.prototype.calculateBoundingBox=function(){},EZ3.ASTROIDAL_ELLIPSOID=function(a,b,c,d,e){EZ3.Geometry.call(this),this._slices=e,this._stacks=d,this._radiusx=a,this._radiusy=b,this._radiusz=c,this.create()},EZ3.ASTROIDAL_ELLIPSOID.prototype.create=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n;for(l=vec3.create(),k=vec3.create(),m=1/(this._slices-1),n=1/(this._stacks-1),a=0;a<this._slices;++a)for(b=0;b<this._stacks;++b)i=a*m,j=b*n,g=this.DOUBLE_PI*i-this.PI,h=this.PI*j-this.HALF_PI,c=Math.pow(Math.cos(g),3),d=Math.pow(Math.cos(h),3),e=Math.pow(Math.sin(g),3),f=Math.pow(Math.sin(h),3),l[0]=this._radiusx*d*c,l[1]=this._radiusy*f,l[2]=this._radiusz*d*e,k[0]=l[0]/this._xradius,k[1]=l[1]/this._yradius,k[2]=l[2]/this._zradius,vec3.normalize(k,k),this._uv.push(i),this._uv.push(j),this._normals.push(k[0]),this._normals.push(k[1]),this._normals.push(k[2]),this._vertices.push(l[0]),this._vertices.push(l[1]),this._vertices.push(l[2]);for(a=0;a<this._slices-1;++a)for(b=0;b<this._stacks-1;++b)this._indices.push((a+0)*this._stacks+(b+0)),this._indices.push((a+0)*this._stacks+(b+1)),this._indices.push((a+1)*this._stacks+(b+1)),this._indices.push((a+0)*this._stacks+(b+0)),this._indices.push((a+1)*this._stacks+(b+1)),this._indices.push((a+1)*this._stacks+(b+0))},EZ3.BOX=function(a,b,c){EZ3.Geometry.call(this),this._width=a,this._depth=c,this._height=b,this._halfWidth=.5*this._width,this._halfDepth=.5*this._depth,this._halfHeight=.5*this._height,this.create()},EZ3.BOX.prototype.create=function(){this._vertices=[+this._halfWidth,+this._halfHeight,+this._halfDepth,-this._halfWidth,+this._halfHeight,+this._halfDepth,-this._halfWidth,-this._halfHeight,+this._halfDepth,+this._halfWidth,-this._halfHeight,+this._halfDepth,+this._halfWidth,-this._halfHeight,-this._halfDepth,-this._halfWidth,-this._halfHeight,-this._halfDepth,-this._halfWidth,+this._halfHeight,-this._halfDepth,+this._halfWidth,+this._halfHeight,-this._halfDepth],this._indices=[]},EZ3.CONE=function(a,b,c,d){EZ3.Geometry.call(this),this._base=a,this._height=b,this._slices=c,this._stacks=d,this.create()},EZ3.CONE.prototype.create=function(){var a,b,c,d,e,f,g,h,i,j,k;for(j=1/(this._slices-1),k=1/(this._stacks-1),f=this._height,i=(this._height-this._base)/this._slices,g=vec3.create(),h=vec3.create(),a=0;a<this._slices;++a)for(b=0;b<this._stacks&&(c=a*j,d=b*k,e=.5*Math.abs(this._height-f),g[0]=e*Math.cos(this.DOUBLE_PI*d),g[1]=f,g[2]=e*Math.sin(this.DOUBLE_PI*d),h[0]=g[0],h[1]=g[1],h[2]=g[2],(0!==h[0]||0!==h[1]||0!==h[2])&&vec3.normalize(h,h),this._vertices.push(g[0]),this._vertices.push(g[1]),this._vertices.push(g[2]),this._normals.push(h[0]),this._normals.push(h[1]),this._normals.push(h[2]),this._uv.push(c),this._uv.push(d),f-=i,!(f<this._base));++b);for(a=0;a<this._slices-1;++a)for(b=0;b<this._stacks-1;++b)this._indices.push((a+0)*this._stacks+(b+0)),this._indices.push((a+0)*this._stacks+(b+1)),this._indices.push((a+1)*this._stacks+(b+1)),this._indices.push((a+0)*this._stacks+(b+0)),this._indices.push((a+1)*this._stacks+(b+1)),this._indices.push((a+1)*this._stacks+(b+0))},EZ3.ELLIPSOID=function(a,b,c,d,e){EZ3.Geometry.call(this),this._slices=d,this._stacks=e,this._xRadius=a,this._yRadius=b,this._zRadius=c,this.create()},EZ3.ELLIPSOID.prototype.create=function(){var a,b,c,d,e,f,g,h,i,j;for(h=vec3.create(),g=vec3.create(),i=1/(this.slices-1),j=1/(this.stacks-1),a=0;a<this.slices;++a)for(b=0;b<this.stacks;++b)e=a*i,f=b*j,c=this.DOUBLE_PI*e,d=this.PI*f,h[0]=this.xRadius*Math.cos(c)*Math.sin(d),h[1]=this.yRadius*Math.sin(d-this.HALF_PI),h[2]=this.zRadius*Math.sin(c)*Math.sin(d),g[0]=h[0]/this.xRadius,g[1]=h[1]/this.yRadius,g[2]=h[2]/this.zRadius,vec3.normalize(g,g),this.uv.push(e),this.uv.push(f),this.normals.push(g[0]),this.normals.push(g[1]),this.normals.push(g[2]),this.vertices.push(h[0]),this.vertices.push(h[1]),this.vertices.push(h[2]);for(a=0;a<this.slices-1;++a)for(b=0;b<this.stacks-1;++b)this.indices.push((a+0)*this.stacks+(b+0)),this.indices.push((a+0)*this.stacks+(b+1)),this.indices.push((a+1)*this.stacks+(b+1)),this.indices.push((a+0)*this.stacks+(b+0)),this.indices.push((a+1)*this.stacks+(b+1)),this.indices.push((a+1)*this.stacks+(b+0))},EZ3.GRID=function(a,b){EZ3.Geometry.call(this),this._width=a,this._height=b},EZ3.SPHERE=function(a,b,c){EZ3.Geometry.call(this),this._radius=a,this._slices=b,this._stacks=c,this.create()},EZ3.SPHERE.prototype.create=function(){var a,b,c,d,e,f,g,h,i,j;for(h=vec3.create(),g=vec3.create(),i=1/(this._slices-1),j=1/(this._stacks-1),a=0;a<this._slices;++a)for(b=0;b<this._stacks;++b)e=a*i,f=b*j,c=this.DOUBLE_PI*e,d=this.PI*f,h[0]=this._radius*Math.cos(c)*Math.sin(d),h[1]=this._radius*Math.sin(d-this.HALF_PI),h[2]=this._radius*Math.sin(c)*Math.sin(d),g[0]=h[0]/this._radius,g[1]=h[1]/this._radius,g[2]=h[2]/this._radius,vec3.normalize(g,g),this._uv.push(e),this._uv.push(f),this._normals.push(g[0]),this._normals.push(g[1]),this._normals.push(g[2]),this._vertices.push(h[0]),this._vertices.push(h[1]),this._vertices.push(h[2]);for(a=0;a<this._slices-1;++a)for(b=0;b<this._stacks-1;++b)this._indices.push((a+0)*this._stacks+(b+0)),this._indices.push((a+0)*this._stacks+(b+1)),this._indices.push((a+1)*this._stacks+(b+1)),this._indices.push((a+0)*this._stacks+(b+0)),this._indices.push((a+1)*this._stacks+(b+1)),this._indices.push((a+1)*this._stacks+(b+0))},EZ3.TORUS=function(a,b,c,d){EZ3.Geometry.call(this),this._sides=c,this._rings=d,this._innerRadius=a,this._outerRadius=b,this.create()},EZ3.TORUS.prototype.create=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n;for(m=1/(this._sides-1),n=1/(this._rings-1),a=vec3.create(),b=vec3.create(),k=0;k<this._sides;++k)for(l=0;l<this._rings;++l)c=k*m,d=l*n,i=this.DOUBLE_PI*c,j=this.DOUBLE_PI*d,e=Math.cos(i),f=Math.cos(j),g=Math.sin(i),h=Math.sin(j),a[0]=(this._innerRadius+this._outerRadius*f)*e,a[1]=this._outerRadius*h,a[2]=(this._innerRadius+this._outerRadius*f)*g,b[0]=a[0]-this._innerRadius*e,b[1]=a[1],b[2]=a[2]-this._innerRadius*g,vec3.normalize(b,b),this.uv.push(c),this.uv.push(d),this.normals.push(b[0]),this.normals.push(b[1]),this.normals.push(b[2]),this.vertices.push(a[0]),this.vertices.push(a[1]),this.vertices.push(a[2]);for(k=0;k<this._sides-1;++k)for(l=0;l<this._rings-1;++l)this.indices.push((k+0)*this._rings+(l+0)),this.indices.push((k+0)*this._rings+(l+1)),this.indices.push((k+1)*this._rings+(l+1)),this.indices.push((k+0)*this._rings+(l+0)),this.indices.push((k+1)*this._rings+(l+1)),this.indices.push((k+1)*this._rings+(l+0))};
