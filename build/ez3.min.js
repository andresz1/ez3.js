/*! ez3 27-07-2015 */
var EZ3={VERSION:"1.0.0",Signal:signals.Signal};EZ3.Engine=function(a,b){this.canvas=a||document.createElement("canvas"),this.canvas.width=a.width||800,this.canvas.height=a.height||600;try{this.gl=a.getContext("webgl",b)||a.getContext("experimental-webgl",b)}catch(c){throw new Error("WebGl not supported")}this.setViewport(0,0,this.canvas.width,this.canvas.height)},EZ3.Engine.prototype.setViewport=function(a,b,c,d){this.gl.viewport(a,b,c,d)},EZ3.Key=function(){},EZ3.Key.prototype.EZ3.Keyboard=function(a){this._domElement=a,this.enabled=!0},EZ3.Keyboard.prototype.enable=function(){this.enabled=!0},EZ3.Keyboard.prototype.disable=function(){this.enabled=!1},EZ3.Geometry=function(a){this._uv=[],this._indices=[],this._normals=[],this._vertices=[],this._tangents=[],this._binormals=[],this._maxPoint=vec3.create(),this._minPoint=vec3.create(),this._midPoint=vec3.create()},EZ3.Geometry.prototype.initArray=function(a,b){return Array.apply(null,new Array(a)).map(function(){return b})},EZ3.Geometry.prototype.calculateNormals=function(){var a,b,c,d,e,f,g,h,i,j,k=initArray(this.vertices.length,0),l=initArray(this.vertices.length/3,0);for(d=0;d<this.indices.length;d+=3)a=3*this.indices[d+0],b=3*this.indices[d+1],c=3*this.indices[d+2],f=vec3.create(this.vertices[a+0],this.vertices[a+1],this.vertices[a+2]),g=vec3.create(this.vertices[b+0],this.vertices[b+1],this.vertices[b+2]),h=vec3.create(this.vertices[c+0],this.vertices[c+1],this.vertices[c+2]),vec3.subtract(i,g,f),vec3.subtract(j,h,f),vec3.cross(e,i,j),(0!==e.x||0!==e.y||0!==e.z)&&vec3.normalize(e,e),k[a+0]+=e[0],k[a+1]+=e[1],k[a+2]+=e[2],k[b+0]+=e[0],k[b+1]+=e[1],k[b+2]+=e[2],k[c+0]+=e[0],k[c+1]+=e[1],k[c+2]+=e[2],++l[a/3],++l[b/3],++l[c/3];for(d=0;d<this._vertices.length/3;++d)a=3*d+0,b=3*d+1,c=3*d+2,this._normals.push(k[a]/l[d]),this._normals.push(k[b]/l[d]),this._normals.push(k[c]/l[d]);k.splice(0,k.length),l.splice(0,l.length)},EZ3.Geometry.prototype.updateMaxPoint=function(a,b,c){this._maxPoint[0]=Math.max(this._maxPoint[0],a),this._maxPoint[1]=Math.max(this._maxPoint[1],b),this._maxPoint[2]=Math.max(this._maxPoint[2],c)},EZ3.Geometry.prototype.updateMinPoint=function(a,b,c){this._minPoint[0]=Math.min(this._minPoint[0],a),this._minPoint[1]=Math.min(this._minPoint[1],b),this._minPoint[2]=Math.min(this._minPoint[2],c)},EZ3.Geometry.prototype.calculateMidPoint=function(){this._midPoint[0]=.5*(this._maxPoint[0]+this._minPoint[0]),this._midPoint[0]=.5*(this._maxPoint[1]+this._minPoint[1]),this._midPoint[0]=.5*(this._maxPoint[2]+this._minPoint[2])},EZ3.Geometry.prototype.calculateTangents=function(){},EZ3.Geometry.prototype.calculateBoundingBox=function(){},EZ3.ASTROIDAL_ELLIPSOID=function(a,b,c,d,e){this._slices=e,this._stacks=d,this._radiusx=a,this._radiusy=b,this._radiusz=c,this.uv=[],this.indices=[],this.normals=[],this.vertices=[],this.PI=Math.PI,this.HALF_PI=this.PI/2,this.DOUBLE_PI=2*this.PI,this.create()},EZ3.ASTROIDAL_ELLIPSOID.prototype.create=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n;for(l=vec3.create(),k=vec3.create(),m=1/(this._slices-1),n=1/(this._stacks-1),a=0;a<this._slices;++a)for(b=0;b<this._stacks;++b)i=a*m,j=b*n,g=this.DOUBLE_PI*i-this.PI,h=this.PI*j-this.HALF_PI,c=Math.pow(Math.cos(g),3),d=Math.pow(Math.cos(h),3),e=Math.pow(Math.sin(g),3),f=Math.pow(Math.sin(h),3),l[0]=this._radiusx*d*c,l[1]=this._radiusy*f,l[2]=this._radiusz*d*e,k[0]=l[0]/this._xradius,k[1]=l[1]/this._yradius,k[2]=l[2]/this._zradius,vec3.normalize(k,k),this.uv.push(i),this.uv.push(j),this.normals.push(k[0]),this.normals.push(k[1]),this.normals.push(k[2]),this.vertices.push(l[0]),this.vertices.push(l[1]),this.vertices.push(l[2]);for(a=0;a<this._slices-1;++a)for(b=0;b<this._stacks-1;++b)this.indices.push((a+0)*this._stacks+(b+0)),this.indices.push((a+0)*this._stacks+(b+1)),this.indices.push((a+1)*this._stacks+(b+1)),this.indices.push((a+0)*this._stacks+(b+0)),this.indices.push((a+1)*this._stacks+(b+1)),this.indices.push((a+1)*this._stacks+(b+0))},EZ3.BOX=function(a,b,c){EZ3.Geometry.call(this),this._width=a,this._depth=c,this._height=b,this._halfWidth=this._width/2,this._halfDepth=this._depth/2,this._halfHeight=this._height/2,this.create()},EZ3.BOX.prototype.create=function(){this.vertices.push(this._halfWidth),this.vertices.push(this._halfHeight),this.vertices.push(this._halfDepth),this.vertices.push(-this._halfWidth),this.vertices.push(this._halfHeight),this.vertices.push(this._halfDepth),this.vertices.push(-this._halfWidth),this.vertices.push(-this._halfHeight),this.vertices.push(this._halfDepth),this.vertices.push(this._halfWidth),this.vertices.push(-this._halfHeight),this.vertices.push(this._halfDepth),this.vertices.push(this._halfWidth),this.vertices.push(-this._halfHeight),this.vertices.push(-this._halfDepth),this.vertices.push(-this._halfWidth),this.vertices.push(-this._halfHeight),this.vertices.push(-this._halfDepth),this.vertices.push(-this._halfWidth),this.vertices.push(this._halfHeight),this.vertices.push(-this._halfDepth),this.vertices.push(this._halfWidth),this.vertices.push(this._halfHeight),this.vertices.push(-this._halfDepth)},EZ3.CONE=function(a,b,c,d){this._base=a,this._height=b,this._slices=c,this._stacks=d,this.uv=[],this.indices=[],this.normals=[],this.vertices=[],this.PI=Math.PI,this.DOUBLE_PI=2*this.PI,this.create()},EZ3.CONE.prototype.create=function(){var a,b,c,d,e,f,g,h,i,j,k;for(j=1/(this._slices-1),k=1/(this._stacks-1),f=this._height,i=(this._height-this._base)/this._slices,g=vec3.create(),h=vec3.create(),a=0;a<this._slices;++a)for(b=0;b<this._stacks&&(c=a*j,d=b*k,e=.5*Math.abs(this._height-f),g[0]=e*Math.cos(this.DOUBLE_PI*d),g[1]=f,g[2]=e*Math.sin(this.DOUBLE_PI*d),h[0]=g[0],h[1]=g[1],h[2]=g[2],(0!==h[0]||0!==h[1]||0!==h[2])&&vec3.normalize(h,h),this.vertices.push(g[0]),this.vertices.push(g[1]),this.vertices.push(g[2]),this.normals.push(h[0]),this.normals.push(h[1]),this.normals.push(h[2]),this.uv.push(c),this.uv.push(d),f-=i,!(f<this._base));++b);for(a=0;a<this._slices-1;++a)for(b=0;b<this._stacks-1;++b)this.indices.push((a+0)*this._stacks+(b+0)),this.indices.push((a+0)*this._stacks+(b+1)),this.indices.push((a+1)*this._stacks+(b+1)),this.indices.push((a+0)*this._stacks+(b+0)),this.indices.push((a+1)*this._stacks+(b+1)),this.indices.push((a+1)*this._stacks+(b+0))},EZ3.ELLIPSOID=function(a,b,c,d,e){this.slices=d,this.stacks=e,this.xRadius=a,this.yRadius=b,this.zRadius=c,this.uv=[],this.indices=[],this.normals=[],this.vertices=[],this.PI=Math.PI,this.HALF_PI=this.PI/2,this.DOUBLE_PI=2*this.PI,this.create()},EZ3.ELLIPSOID.prototype.create=function(){var a,b,c,d,e,f,g,h,i,j;for(h=vec3.create(),g=vec3.create(),i=1/(this.slices-1),j=1/(this.stacks-1),a=0;a<this.slices;++a)for(b=0;b<this.stacks;++b)e=a*i,f=b*j,c=this.DOUBLE_PI*e,d=this.PI*f,h[0]=this.xRadius*Math.cos(c)*Math.sin(d),h[1]=this.yRadius*Math.sin(d-this.HALF_PI),h[2]=this.zRadius*Math.sin(c)*Math.sin(d),g[0]=h[0]/this.xRadius,g[1]=h[1]/this.yRadius,g[2]=h[2]/this.zRadius,vec3.normalize(g,g),this.uv.push(e),this.uv.push(f),this.normals.push(g[0]),this.normals.push(g[1]),this.normals.push(g[2]),this.vertices.push(h[0]),this.vertices.push(h[1]),this.vertices.push(h[2]);for(a=0;a<this.slices-1;++a)for(b=0;b<this.stacks-1;++b)this.indices.push((a+0)*this.stacks+(b+0)),this.indices.push((a+0)*this.stacks+(b+1)),this.indices.push((a+1)*this.stacks+(b+1)),this.indices.push((a+0)*this.stacks+(b+0)),this.indices.push((a+1)*this.stacks+(b+1)),this.indices.push((a+1)*this.stacks+(b+0))},EZ3.SPHERE=function(a,b,c){this._radius=a,this._slices=b,this._stacks=c,this.uv=[],this.indices=[],this.normals=[],this.vertices=[],this.PI=Math.PI,this.HALF_PI=this.PI/2,this.DOUBLE_PI=2*this.PI,this.create()},EZ3.SPHERE.prototype.create=function(){var a,b,c,d,e,f,g,h,i,j;for(h=vec3.create(),g=vec3.create(),i=1/(this._slices-1),j=1/(this._stacks-1),a=0;a<this._slices;++a)for(b=0;b<this._stacks;++b)e=a*i,f=b*j,c=this.DOUBLE_PI*e,d=this.PI*f,h[0]=this.radius*Math.cos(c)*Math.sin(d),h[1]=this.radius*Math.sin(d-this.HALF_PI),h[2]=this.radius*Math.sin(c)*Math.sin(d),g[0]=h[0]/this._radius,g[1]=h[1]/this._radius,g[2]=h[2]/this._radius,vec3.normalize(g,g),this.uv.push(e),this.uv.push(f),this.normals.push(g[0]),this.normals.push(g[1]),this.normals.push(g[2]),this.vertices.push(h[0]),this.vertices.push(h[1]),this.vertices.push(h[2]);for(a=0;a<this._slices-1;++a)for(b=0;b<this._stacks-1;++b)this.indices.push((a+0)*this._stacks+(b+0)),this.indices.push((a+0)*this._stacks+(b+1)),this.indices.push((a+1)*this._stacks+(b+1)),this.indices.push((a+0)*this._stacks+(b+0)),this.indices.push((a+1)*this._stacks+(b+1)),this.indices.push((a+1)*this._stacks+(b+0))},EZ3.TORUS=function(a,b,c,d){this._sides=c,this._rings=d,this._innerRadius=a,this._outerRadius=b,this.uv=[],this.indices=[],this.normals=[],this.vertices=[],this.PI=Math.PI,this.DOUBLE_PI=2*this.PI,this.create()},EZ3.TORUS.prototype.create=function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n;for(m=1/(this._sides-1),n=1/(this._rings-1),a=vec3.create(),b=vec3.create(),k=0;k<this._sides;++k)for(l=0;l<this._rings;++l)c=k*m,d=l*n,i=this.DOUBLE_PI*c,j=this.DOUBLE_PI*d,e=Math.cos(i),f=Math.cos(j),g=Math.sin(i),h=Math.sin(j),a[0]=(this._innerRadius+this._outerRadius*f)*e,a[1]=this._outerRadius*h,a[2]=(this._innerRadius+this._outerRadius*f)*g,b[0]=a[0]-this._innerRadius*e,b[1]=a[1],b[2]=a[2]-this._innerRadius*g,vec3.normalize(b,b),this.uv.push(c),this.uv.push(d),this.normals.push(b[0]),this.normals.push(b[1]),this.normals.push(b[2]),this.vertices.push(a[0]),this.vertices.push(a[1]),this.vertices.push(a[2]);for(k=0;k<this._sides-1;++k)for(l=0;l<this._rings-1;++l)this.indices.push((k+0)*this._rings+(l+0)),this.indices.push((k+0)*this._rings+(l+1)),this.indices.push((k+1)*this._rings+(l+1)),this.indices.push((k+0)*this._rings+(l+0)),this.indices.push((k+1)*this._rings+(l+1)),this.indices.push((k+1)*this._rings+(l+0))};